---
# tasks file for apache-maven
- name: Checking if Maven is already installed
  stat: 
    path: '/opt/apache-maven-3.5.2'
  register: maven_installed

- name: Downloading Maven Binaries
  get_url:
    url: 'http://www.apache.org/dist/maven/maven-3/3.5.2/binaries/apache-maven-3.5.2-bin.tar.gz'
    dest: '/opt/bin'
    url_username: ''
    url_password: ''
  when: maven_installed.stat.exists != True

- name: Unarchive Maven Binaries
  unarchive:
    src: '/opt/bin'
    dest: '/opt'
    copy: no
  when: maven_installed.stat.exists != True

- name: Remove old path configuration
  file:
    path: /etc/profile.d/maven.sh
    state: absent

- name: Maven path configuration
  lineinfile:
    dest: /etc/profile.d/maven.sh
    create: yes
    state: present
  with_items:
    - { line: 'M2_HOME=/opt/apache-maven-3.5.2' }
    - { line: 'PATH=$PATH:$M2_HOME/bin' }

- name: Cleaning Up
  file:
    state: absent
    path: '/opt/bin'
